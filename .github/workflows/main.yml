name: 'Update infra'

on:
  push:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  check-infra:
    name: Check infra
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run Check Infra Action
        uses: ./.github/actions/check-infra
        with:
          TF_API_TOKEN: ${{ secrets.TF_API_TOKEN }}
          INFRA_DIR: ./packages/infra/staging

  deploy-infra:
    name: Deploy infra
    runs-on: ubuntu-latest
    needs: check-infra

    steps:
      - uses: actions/checkout@v4

      - name: Run Deploy Infra Action
        uses: ./.github/actions/deploy-infra
        with:
          TF_API_TOKEN: ${{ secrets.TF_API_TOKEN }}
          INFRA_DIR: ./packages/infra/staging

